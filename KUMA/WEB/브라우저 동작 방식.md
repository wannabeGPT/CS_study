# 브라우저 동작 방식

### 브라우저 주요 기능
* `사용자가 선택한 자원`을 `서버에 요청(Request)`하고 응답(Response)를 받아 `브라우저에 표시`한다.
* 자원은 보통 HTML 문서지만 PDF나 이미지 또는 다른 형태일 수도 있다.
  * 자원의 주소는 `URI`(Uniform Resource Identifier)에 의해 정해진다.

### 자원의 종류에 따른 처리 엔진
* HTML, CSS
  * `렌더링 엔진의 HTML 파서와 CSS 파서에 의해 파싱(Parsing)`되어 DOM, CSSOM 트리로 변환되고 `렌더 트리로 결합`된다.
  * 이렇게 생성된 렌더 트리를 기반으로 브라우저는 웹페이지를 표시한다.
* JavaScript
  * `자바스크립트는 자바스크립트 엔진이 처리`한다. 
  * HTML 파서는 script 태그를 만나면 자바스크립트 코드를 실행하기 위해 DOM 생성 프로세스를 중지하고 자바스크립트 엔진으로 제어 권한을 넘긴다.
  * 제어 권한을 받은 자바스크립트 엔진은 script 태그내의 자바스크립트 코드 또는 script 태그의 src 어트리뷰트에 정의된 자바스크립트 파일을 로드하고 파싱하여 실행한다.
  * 자바스크립트의 실행이 완료되면 다시 HTML 파서로 제어 권한을 넘겨서 브라우저가 중지했던 시점부터 DOM 생성을 재개한다.

### 브라우저의 성능과 지연시간
* 사용자는 `로드가 빠르고 상호작용이 원활`한 컨텐츠로 이뤄진 웹 경험을 원한다.
* 따라서 대다수의 브라우저는 `싱글 쓰레드`이다.

## 브라우저의 동작 과정
### 탐색(Navigation)
   * 탐색(Navigation)은 웹페이지를 로딩하는 첫 단계이다. 사용자가 주소창에 `URL을 입력`하거나, `링크를 클릭`하고, `폼(form)을 제출`하는 등의 동작을 통해 요청을 보낼 때마다 발생한다.
   * `웹 최적화의 목표 중 하나는 탐색이 완료될 때까지의 시간을 최소화 하는 것`이다. 이상적인 조건에서 그다지 오래 걸리는 작업이 아니지만 지연시간과 대역폭은 지연을 일으키는 적이다.
1. DNS 조회 (DNS Lookup)
   * 탐색하려는 페이지의 자원이 어디에 위치하는지 찾는 것
     * 한 번도 방문한 적이 없을 경우 - DNS 조회를 실행, 네임 서버는 IP 주소로 응답한다. 
     응답하고 나서는 일정 시간동안 IP가 캐시된다. 
     * 방문한 적이 있을 경우 - 캐싱된 IP를 얻어온다.
   * DNS 조회는 호스트 이름 하나 당 한 번만 수행된다.
     * 하지만 요청된 페이지에서 참조하는 다른 호스트 이름에 대해서 각각 수행되기 때문에 성능 저하를 야기한다. -> 특히 모바일 환경에서 각각의 DNS 조회 과정에 셀타워와 통신사를 거쳐야 하기 때문에 심하다.
     ![latency](./img/mobile_latency.jpg)

2. TCP 핸드셰이크 (TCP Handshake)
   * IP 주소를 알고난 후에는 3-way 핸드셰이크를 통해 연결을 설정한다.
   * 데이터를 주고 받기 전, 통신하려는 두 주체가 TCP 소켓 연결을 위한 매개변수를 주고 받는다.
   * 두 주체가 TCP 세션을 협상하고 시작하기 위해서 TCP가 SYN, SYN-ACK, ACK 3개의 메세지를 전달한다.

3. TLS 협상 (TLS Negotiation)

### References
[Naver D2](https://d2.naver.com/helloworld/59361)
[Poiema Web](https://poiemaweb.com/js-browser)
[mdn web docs](https://developer.mozilla.org/ko/docs/Web/Performance/How_browsers_work)